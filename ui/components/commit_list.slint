import { ThemeColors } from "../theme.slint";
import { PrCommitEntry } from "../structs.slint";

export component CommitList inherits Rectangle {
    in property <ThemeColors> theme;
    in property <[PrCommitEntry]> commits: [];
    in property <int> selected-index: -1;  // -1 = all changes

    callback commit-selected(int);

    property <bool> expanded: true;

    // Only show when there are commits
    visible: commits.length > 0;

    background: theme.bg-secondary;

    VerticalLayout {
        // Header (collapsible)
        Rectangle {
            height: 32px;
            background: header-touch.has-hover ? theme.bg-hover : transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                HorizontalLayout {
                    spacing: 8px;
                    alignment: start;

                    // Collapse arrow
                    Text {
                        text: expanded ? "▼" : "▶";
                        color: theme.text-muted;
                        font-size: 10px;
                        vertical-alignment: center;
                    }

                    Text {
                        text: "Commits";
                        color: theme.text-secondary;
                        font-size: 12px;
                        font-weight: 600;
                        vertical-alignment: center;
                    }

                    // Commit count badge
                    Rectangle {
                        height: 18px;
                        width: count-text.preferred-width + 12px;
                        background: theme.bg-tertiary;
                        border-radius: 9px;

                        count-text := Text {
                            text: commits.length;
                            color: theme.text-muted;
                            font-size: 11px;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }

            header-touch := TouchArea {
                mouse-cursor: pointer;
                clicked => {
                    expanded = !expanded;
                }
            }
        }

        // Commit list (when expanded)
        if expanded: VerticalLayout {
            padding-left: 8px;
            padding-right: 8px;
            padding-bottom: 8px;
            spacing: 2px;

            // "All changes" option
            Rectangle {
                height: 28px;
                background: (selected-index < 0) ? theme.accent-primary :
                    (all-touch.has-hover ? theme.bg-hover : transparent);
                border-radius: 4px;

                HorizontalLayout {
                    padding-left: 10px;
                    padding-right: 10px;
                    alignment: start;

                    Text {
                        text: "All changes";
                        color: (selected-index < 0) ? theme.bg-primary : theme.text-secondary;
                        font-size: 12px;
                        font-weight: (selected-index < 0) ? 600 : 400;
                        vertical-alignment: center;
                    }
                }

                all-touch := TouchArea {
                    mouse-cursor: pointer;
                    clicked => {
                        root.commit-selected(-1);
                    }
                }
            }

            // Commit entries
            for commit[idx] in commits: Rectangle {
                height: 28px;
                background: (idx == selected-index) ? theme.accent-primary :
                    (commit-touch.has-hover ? theme.bg-hover : transparent);
                border-radius: 4px;

                HorizontalLayout {
                    padding-left: 10px;
                    padding-right: 10px;
                    spacing: 8px;
                    alignment: start;

                    // Short SHA
                    Text {
                        text: commit.short-sha;
                        color: (idx == selected-index) ? theme.bg-primary : theme.accent-primary;
                        font-size: 11px;
                        font-family: "monospace";
                        vertical-alignment: center;
                    }

                    // Commit summary
                    Text {
                        text: commit.summary;
                        color: (idx == selected-index) ? theme.bg-primary : theme.text-secondary;
                        font-size: 12px;
                        vertical-alignment: center;
                        overflow: elide;
                    }
                }

                commit-touch := TouchArea {
                    mouse-cursor: pointer;
                    clicked => {
                        root.commit-selected(idx);
                    }
                }
            }
        }

        // Bottom border
        Rectangle {
            height: 1px;
            background: theme.border-subtle;
        }
    }
}
