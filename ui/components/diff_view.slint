import { ThemeColors } from "../theme.slint";
import { DiffLine } from "../structs.slint";
import { UnifiedView } from "unified.slint";
import { SideBySideView } from "side_by_side.slint";

export component DiffView inherits Rectangle {
    in property <ThemeColors> theme;
    in property <bool> side-by-side;
    in property <string> selected-file;
    in property <[DiffLine]> lines: [];
    in property <length> font-size: 13px;
    in-out property <length> scroll-position: 0;
    in property <length> scroll-step: 60px;

    background: theme.bg-primary;

    // Reset scroll when file changes
    property <string> prev-selected-file: "";
    changed selected-file => {
        if (root.selected-file != root.prev-selected-file) {
            root.scroll-position = 0;
            root.prev-selected-file = root.selected-file;
        }
    }

    if selected-file == "": Rectangle {
        // Empty state
        VerticalLayout {
            alignment: center;

            Text {
                text: "Select a file to view diff";
                color: theme.text-muted;
                font-size: 14px;
                horizontal-alignment: center;
            }
        }
    }

    if selected-file != "" && !side-by-side: UnifiedView {
        theme: root.theme;
        lines: root.lines;
        font-size: root.font-size;
        scroll-position <=> root.scroll-position;
        scroll-step: root.scroll-step;
    }

    if selected-file != "" && side-by-side: SideBySideView {
        theme: root.theme;
        lines: root.lines;
        font-size: root.font-size;
        scroll-position <=> root.scroll-position;
        scroll-step: root.scroll-step;
    }
}
